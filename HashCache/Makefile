CC = gcc
DEBUG_FLAGS = -g
COMPILER_FLAGS = -m32 -Wall -O3
LINK_FLAGS = #-lssl -lm
HASHCACHE_FLAGS = -DURL_SIZE=100 -DHTTP_BLOCK_SIZE=8192 -DFILE_BLOCK_SIZE=2048
INDEX_FLAGS = -DLRU=0 -DFULL=100 -DCOMPLETE_LOG=100 -DWAYS=8 -DLWAYS=3
CACHE_FLAGS = -DUSE_HOC=100 -DUSE_DIRTY_CACHE=100
CONN_FLAGS = -DPERSISTENT=100 -DPERSISTENT_CLIENT=100 -DUSE_DNS_CLONE=0
OS_FLAGS = -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -D_XOPEN_SOURCE=500 -DMY_FD_SETSIZE=1024
WAPROX_FLAGS = -DUSE_WAPROX_HEADER=100

INCLUDES = ./inc
SOURCES = ./src
OBJECTS = ./obj
BINARIES = ./bin
MAKEFILE = Makefile
objects = $(OBJECTS)/init.o $(OBJECTS)/getLocation.o $(OBJECTS)/basic_mmh.o $(OBJECTS)/loop.o $(OBJECTS)/helper.o $(OBJECTS)/hashtab.o $(OBJECTS)/recycle.o $(OBJECTS)/lookupa.o $(OBJECTS)/list.o $(OBJECTS)/http.o $(OBJECTS)/httpHeaders.o $(OBJECTS)/locks.o $(OBJECTS)/proxy.o $(OBJECTS)/common.o $(OBJECTS)/dns.o $(OBJECTS)/conn.o $(OBJECTS)/index.o $(OBJECTS)/buffer.o $(OBJECTS)/hcfs.o $(OBJECTS)/queue.o $(OBJECTS)/memSys.o $(OBJECTS)/batch.o $(OBJECTS)/hoc.o $(OBJECTS)/dirty.o $(OBJECTS)/elevator.o

cache : $(MAKEFILE) $(objects) 
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) $(LINK_FLAGS) $(objects) libssl.a libcrypto.a -o $(BINARIES)/cache
$(OBJECTS)/init.o : $(MAKEFILE) $(INCLUDES)/init.h $(INCLUDES)/list.h $(INCLUDES)/unp.h $(INCLUDES)/hashtab.h $(SOURCES)/init.c $(INCLUDES)/hcfs.h $(INCLUDES)/dns.h $(INCLUDES)/http.h $(INCLUDES)/locks.h 
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/init.c -o $(OBJECTS)/init.o
$(OBJECTS)/hcfs.o : $(MAKEFILE) $(INCLUDES)/hcfs.h $(SOURCES)/hcfs.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/hcfs.c -o $(OBJECTS)/hcfs.o
$(OBJECTS)/getLocation.o : $(MAKEFILE) $(INCLUDES)/getLocation.h $(SOURCES)/getLocation.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/getLocation.c -o $(OBJECTS)/getLocation.o
$(OBJECTS)/basic_mmh.o : $(MAKEFILE) $(INCLUDES)/basic_mmh.h $(SOURCES)/basic_mmh.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/basic_mmh.c -o $(OBJECTS)/basic_mmh.o
$(OBJECTS)/loop.o : $(MAKEFILE) $(INCLUDES)/init.h $(INCLUDES)/loop.h $(SOURCES)/loop.c  $(INCLUDES)/proxy.h $(INCLUDES)/list.h $(INCLUDES)/hashtab.h $(INCLUDES)/http.h $(INCLUDES)/hcfs.h $(INCLUDES)/fdset.h
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/loop.c -o $(OBJECTS)/loop.o
$(OBJECTS)/helper.o : $(MAKEFILE) $(INCLUDES)/helper.h $(INCLUDES)/list.h $(INCLUDES)/hcfs.h $(SOURCES)/helper.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/helper.c -o $(OBJECTS)/helper.o
$(OBJECTS)/hashtab.o : $(MAKEFILE) $(INCLUDES)/standard.h $(INCLUDES)/hashtab.h $(SOURCES)/hashtab.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/hashtab.c -o $(OBJECTS)/hashtab.o
$(OBJECTS)/lookupa.o : $(MAKEFILE) $(INCLUDES)/standard.h $(INCLUDES)/lookupa.h $(SOURCES)/lookupa.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/lookupa.c -o $(OBJECTS)/lookupa.o
$(OBJECTS)/recycle.o : $(MAKEFILE) $(INCLUDES)/standard.h $(INCLUDES)/recycle.h $(SOURCES)/recycle.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/recycle.c -o $(OBJECTS)/recycle.o
$(OBJECTS)/list.o : $(MAKEFILE) $(INCLUDES)/list.h $(SOURCES)/list.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/list.c -o $(OBJECTS)/list.o
$(OBJECTS)/http.o : $(MAKEFILE) $(INCLUDES)/http.h $(SOURCES)/http.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/http.c -o $(OBJECTS)/http.o
$(OBJECTS)/httpHeaders.o : $(MAKEFILE) $(INCLUDES)/http.h $(INCLUDES)/httpHeaders.h $(SOURCES)/httpHeaders.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/httpHeaders.c -o $(OBJECTS)/httpHeaders.o
$(OBJECTS)/locks.o : $(MAKEFILE) $(INCLUDES)/locks.h $(INCLUDES)/hashtab.h $(SOURCES)/locks.c $(INCLUDES)/hcfs.h
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/locks.c -o $(OBJECTS)/locks.o
$(OBJECTS)/proxy.o : $(MAKEFILE) $(INCLUDES)/hcfs.h $(INCLUDES)/proxy.h $(SOURCES)/proxy.c $(INCLUDES)/http.h $(INCLUDES)/conn.h  
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/proxy.c -o $(OBJECTS)/proxy.o
$(OBJECTS)/common.o : $(MAKEFILE) $(INCLUDES)/common.h $(SOURCES)/common.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/common.c -o $(OBJECTS)/common.o
$(OBJECTS)/dns.o : $(MAKEFILE) $(INCLUDES)/dns.h $(INCLUDES)/list.h $(INCLUDES)/hashtab.h $(SOURCES)/dns.c $(INCLUDES)/hcfs.h
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/dns.c -o $(OBJECTS)/dns.o
$(OBJECTS)/conn.o : $(MAKEFILE) $(INCLUDES)/conn.h $(INCLUDES)/http.h $(INCLUDES)/hashtab.h $(INCLUDES)/list.h $(SOURCES)/conn.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/conn.c -o $(OBJECTS)/conn.o
$(OBJECTS)/index.o : $(MAKEFILE) $(INCLUDES)/index.h $(INCLUDES)/list.h $(INCLUDES)/hashtab.h $(INCLUDES)/hcfs.h $(SOURCES)/index.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/index.c -o $(OBJECTS)/index.o
$(OBJECTS)/buffer.o : $(MAKEFILE) $(INCLUDES)/buffer.h $(INCLUDES)/list.h $(INCLUDES)/hashtab.h $(INCLUDES)/hcfs.h $(SOURCES)/buffer.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/buffer.c -o $(OBJECTS)/buffer.o
$(OBJECTS)/queue.o : $(MAKEFILE) $(INCLUDES)/queue.h $(INCLUDES)/list.h $(SOURCES)/queue.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/queue.c -o $(OBJECTS)/queue.o
$(OBJECTS)/batch.o : $(MAKEFILE) $(INCLUDES)/batch.h $(SOURCES)/batch.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/batch.c -o $(OBJECTS)/batch.o
$(OBJECTS)/memSys.o : $(MAKEFILE) $(INCLUDES)/memSys.h $(SOURCES)/memSys.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/memSys.c -o $(OBJECTS)/memSys.o
$(OBJECTS)/hoc.o : $(MAKEFILE) $(INCLUDES)/hoc.h $(SOURCES)/hoc.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/hoc.c -o $(OBJECTS)/hoc.o
$(OBJECTS)/dirty.o : $(MAKEFILE) $(INCLUDES)/dirty.h $(SOURCES)/dirty.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/dirty.c -o $(OBJECTS)/dirty.o
$(OBJECTS)/elevator.o : $(MAKEFILE) $(INCLUDES)/elevator.h $(INCLUDES)/helper.h $(INCLUDES)/list.h $(SOURCES)/elevator.c
	$(CC) $(COMPILER_FLAGS) $(DEBUG_FLAGS) $(OS_FLAGS) $(HASHCACHE_FLAGS) $(INDEX_FLAGS) $(CACHE_FLAGS) $(CONN_FLAGS) $(WAPROX_FLAGS) -c -I $(INCLUDES) $(SOURCES)/elevator.c -o $(OBJECTS)/elevator.o

clean : 
	rm -rf $(BINARIES)/cache $(objects)
kill : 
	killall cache
all:
	make cache

